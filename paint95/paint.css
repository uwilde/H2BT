/* ====== Base ====== */
:root { color-scheme: light only; }
html, body {
  height: 100%;
}
body {
  margin: 0;
  font-family: 'MS Sans Serif','Tahoma',sans-serif;
  background: #c0c0c0;
  /* fill the entire iframe from (0,0) */
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  overflow: hidden;
}

/* App frame */
.paint95 {
  width: 100%;
  height: 100%;
  max-width: 100%;
  max-height: 100%;
  background: #c0c0c0;
  border: 2px solid #808080;
  box-shadow: inset -2px -2px #404040, inset 2px 2px #ffffff;
  display: flex;
  flex-direction: column;
  min-width: 0;  /* allow shrink in narrow iframes */
  min-height: 0; /* allow shrink in short iframes */
}

/* ====== Menu bar ====== */
.menu-bar{
  display:flex; gap:2px; padding:2px 4px; background:#c0c0c0; border-bottom:1px solid #808080;
  position: relative; z-index: 3;
}
.menu-item{
  font-size:12px; padding:2px 10px; border:1px solid transparent; background:#c0c0c0; cursor:default;
}
.menu-item:active,.menu-item:focus{ border:1px solid #000080; background:#000080; color:#fff; outline:none; }

/* Dropdowns */
#menu-root{ position:relative; z-index: 4; }
.menu-dropdown{
  position:absolute; top:0px; min-width:180px;
  background:#c0c0c0; border:1px solid #808080; box-shadow: inset -1px -1px #404040, inset 1px 1px #fff;
  padding:2px; display:none;
}
.menu-dropdown.open{ display:block; }
.menu-divider{ height:1px; margin:2px 0; background:#808080; box-shadow: 0 1px 0 #fff; }
.menu-item-row{
  width:100%; display:flex; align-items:center; justify-content:space-between;
  font-size:12px; padding:3px 8px; border:1px solid transparent; background:#c0c0c0; cursor:default;
}
.menu-item-row:hover{ border:1px solid #000080; background:#000080; color:#fff; }

/* Toolbars */
.toolbars{ display:flex; flex:1; overflow:hidden; }
.side-toolbar{
  flex: 0 0 60px; width:60px; padding:6px;
  display:grid; grid-template-columns:repeat(2,1fr); grid-auto-rows:28px; gap:4px;
  background:#c0c0c0; border-right:1px solid #808080; box-shadow: inset -1px 0 #fff, inset 1px 0 #808080;
}
.tool-button{
  background:#c0c0c0; border:1px solid #808080; box-shadow: inset -1px -1px #404040, inset 1px 1px #fff; cursor:default; position:relative;
}
.tool-button::before{
  content:""; position:absolute; inset:3px; background-repeat:no-repeat; background-position:center; background-size:contain; image-rendering:pixelated;
}
.tool-button.active{ border:1px solid #000080; box-shadow: inset 1px 1px #000080, inset -1px -1px #fff; }

/* (SVG icons same as before) */
.tool-button[data-tool="pencil"]::before { background-image:url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"%3E%3Cpath fill="%23000" d="M1 12l3 3h2l8-8-3-3-8 8v2H1zm3 1v-1h1l7-7 1 1-7 7H4z"/%3E%3C/svg%3E'); }
.tool-button[data-tool="brush"]::before { background-image:url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16"%3E%3Cpath fill="%23000" d="M2 11c0 2 1 3 3 3s3-1 3-3c0-1-1-3-3-3-2 0-3 2-3 3zm9-9l3 3-6 6-3-3 6-6z"/%3E%3C/svg%3E'); }
.tool-button[data-tool="eraser"]::before { background-image:url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16"%3E%3Cpath fill="%23000" d="M2 10l4 4h4l4-4-6-6-6 6zm6-5l5 5-3 3H7l-3-3 4-5z"/%3E%3C/svg%3E'); }
.tool-button[data-tool="fill"]::before { background-image:url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16"%3E%3Cpath fill="%23000" d="M7 1L2 6l5 5 5-5L7 1zm0 3l2 2-2 2-2-2 2-2zm6 4c-1 0-2 2-2 3s1 3 2 3 2-2 2-3-1-3-2-3z"/%3E%3C/svg%3E'); }
.tool-button[data-tool="picker"]::before { background-image:url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16"%3E%3Cpath fill="%23000" d="M10 1L3 8v3L0 14l2 2 3-3h3l7-7-5-5zm0 2l3 3-4 4H6L5 9V7l5-4z"/%3E%3C/svg%3E'); }
.tool-button[data-tool="line"]::before { background-image:url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16"%3E%3Cpath stroke="%23000" stroke-width="2" d="M2 14L14 2"/%3E%3C/svg%3E'); }
.tool-button[data-tool="rectangle"]::before { background-image:url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16"%3E%3Crect x="3" y="3" width="10" height="10" fill="none" stroke="%23000" stroke-width="2"/%3E%3C/svg%3E'); }
.tool-button[data-tool="ellipse"]::before { background-image:url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16"%3E%3Cellipse cx="8" cy="8" rx="5" ry="4" fill="none" stroke="%23000" stroke-width="2"/%3E%3C/svg%3E'); }
.tool-button[data-tool="rounded"]::before { background-image:url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16"%3E%3Crect x="3" y="3" width="10" height="10" rx="3" ry="3" fill="none" stroke="%23000" stroke-width="2"/%3E%3C/svg%3E'); }
.tool-button[data-tool="text"]::before { background-image:url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16"%3E%3Cpath fill="%23000" d="M3 3V1h10v2H9v12H7V3H3z"/%3E%3C/svg%3E'); }
.tool-button[data-tool="spray"]::before { background-image:url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16"%3E%3Ccircle cx="6" cy="10" r="1" fill="%23000"/%3E%3Ccircle cx="8" cy="8" r="1" fill="%23000"/%3E%3Ccircle cx="4" cy="8" r="1" fill="%23000"/%3E%3Ccircle cx="8" cy="12" r="1" fill="%23000"/%3E%3Ccircle cx="10" cy="10" r="1" fill="%23000"/%3E%3C/svg%3E'); }
.tool-button[data-tool="zoom"]::before { background-image:url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16"%3E%3Cpath fill="%23000" d="M6 1a5 5 0 013.873 8.146l3.49 3.49-1.414 1.414-3.49-3.49A5 5 0 116 1zm0 2a3 3 0 100 6 3 3 0 000-6z"/%3E%3C/svg%3E'); }

.workspace{ flex:1; display:flex; flex-direction:column; background:#c0c0c0;min-height: 0; }
.option-bars{ padding:4px 8px; border-bottom:1px solid #808080; box-shadow: inset 0 -1px #ffffff; }
.tool-options{ display:flex; gap:16px; align-items:center; flex-wrap:wrap; }
.option-group{ display:flex; gap:4px; padding:4px; background:#c0c0c0; border:1px solid #808080; box-shadow: inset -1px -1px #404040, inset 1px 1px #fff; }

.size-button,.shape-button{ width:28px; height:24px; border:1px solid #c0c0c0; background:#c0c0c0; position:relative; }
.size-button::before{ content:""; position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); background:#000; border-radius:50%; }
.size-button[data-size="1"]::before{ width:2px; height:2px; }
.size-button[data-size="3"]::before{ width:4px; height:4px; }
.size-button[data-size="5"]::before{ width:6px; height:6px; }
.size-button[data-size="8"]::before{ width:10px; height:10px; }
.shape-button[data-shape="outline"]::before, .shape-button[data-shape="filled-outline"]::before, .shape-button[data-shape="filled"]::before{
  content:""; position:absolute; inset:6px; border:1px solid #000;
}
.shape-button[data-shape="filled"]::before{ background:#000; }
.shape-button[data-shape="filled-outline"]::before{ background:#0002; }
.size-button.active,.shape-button.active{ border:1px solid #000080; box-shadow: inset 1px 1px #000080, inset -1px -1px #fff; }

.canvas-container{
  flex:1;
  padding:12px;
  overflow:auto;
  background:#808080;
  min-height: 0;
  box-sizing: border-box;
  display:flex;
  justify-content:center;
  align-items:center;
}
.canvas-frame{
  position:relative;
  background:repeating-conic-gradient(#fff 0deg 90deg, #dcdcdc 90deg 180deg);
  background-size:16px 16px;
  padding:10px;
  box-shadow: inset -2px -2px #404040, inset 2px 2px #fff;
  width:100%;
  max-width:660px;
  box-sizing:border-box;
  margin:0 auto;
}
#paintCanvas{
  display:block;
  width:100%;
  height:auto;
  max-width:640px;
  aspect-ratio: 8 / 5;
  image-rendering:pixelated;
  background:#fff;
  box-shadow: inset -1px -1px #808080, inset 1px 1px #fff;
  cursor:crosshair;
}

.text-tool{
  position:absolute; min-width:120px; min-height:30px; font-family:'MS Sans Serif','Tahoma',sans-serif; font-size:12px;
  border:1px dotted #000; background:transparent; resize:none; outline:none; color:#000; padding:2px; transform-origin:top left;
}

.color-box{ display:flex; gap:12px; align-items:center; padding:6px 12px 12px; background:#c0c0c0; }
.color-preview{ width:54px; height:36px; position:relative; border:1px solid #000; box-shadow: inset -1px -1px #404040, inset 1px 1px #fff; }
.color-primary,.color-secondary{ position:absolute; width:28px; height:24px; border:1px solid #000; }
.color-primary{ top:-6px; left:-6px; background:#000; }
.color-secondary{ bottom:-6px; right:-6px; background:#fff; }
.color-palette{ display:grid; grid-template-columns:repeat(14,20px); gap:2px; padding:4px; background:#c0c0c0; border:1px solid #808080; box-shadow: inset -1px -1px #404040, inset 1px 1px #fff; }
.color-swatch{ width:20px; height:20px; border:1px solid #000; cursor:pointer; }

.status-bar{ font-size:12px; padding:4px 8px; background:#c0c0c0; border-top:1px solid #808080; box-shadow: inset 0 1px #fff; }

@media (max-width:640px){
  body{ align-items:flex-start; }
  .paint95{ width:100%; height:100%; border:none; box-shadow:none; }
  .canvas-container{ padding:8px; }
}


/* ZOOM via transform */
.canvas-frame { position: relative; }
#paintCanvas.zoomed {
  transform-origin: top left;
  image-rendering: pixelated;
  display: block;
}

/* =========================
   ⬇️ Adaptive Add-On (append)
   ========================= */

/* 1) Treat the app as a size container so we can use container queries */
.paint95 {
  container-type: size;
  container-name: app;
}

/* 2) Robust sizing tokens that auto-scale with viewport AND container */
:root {
  --ui-gap: clamp(2px, 1cqw, 8px);
  --ui-pad: clamp(4px, 1.5cqw, 12px);
  --tool-size: clamp(22px, 3cqw, 28px);
  --side-toolbar-width: clamp(46px, 8cqw, 72px);
  --palette-swatch: clamp(14px, 2.2cqw, 20px);
}

/* Respect dynamic viewport units when embedded in iframes on mobile */
html, body, .paint95 {
  height: 90dvh;
}

/* 3) Make the main work zone a grid that can flip between layouts */
.toolbars {
  display: grid;
  grid-template-columns: var(--side-toolbar-width) 1fr;
  grid-template-rows: auto;
  grid-template-areas:
    "side workspace";
  gap: 0;
  min-height: 0;
}

/* Side tools column */
.side-toolbar {
  grid-area: side;
  width: auto;
  flex: 0 0 auto;
  padding: 2px;
  grid-template-columns: repeat(2, 1fr);
  grid-auto-rows: var(--tool-size);
  gap: clamp(2px, 0.8cqw, 6px);
  overflow: auto;            /* scroll if too tight */
}

/* Workspace column */
.workspace {
  grid-area: workspace;
  min-width: 0;
  min-height: 0;
  display: grid;
  grid-template-rows: auto 1fr auto; /* options | canvas | color box */
  grid-template-areas:
    "opts"
    "canvas"
    "colors";
}

/* Sections in workspace */
.option-bars   { grid-area: opts;    padding: var(--ui-pad) calc(var(--ui-pad) * 2); }
.canvas-container { grid-area: canvas; padding: clamp(6px, 1.5cqw, 16px); }
.color-box     { grid-area: colors;  padding: var(--ui-pad) calc(var(--ui-pad) * 2); gap: clamp(6px, 1.5cqw, 16px); }

/* Palette scales down neatly on small widths */
.color-palette {
  grid-template-columns: repeat(14, minmax(var(--palette-swatch), 1fr));
  gap: clamp(1px, 0.5cqw, 3px);
}
.color-swatch {
  width: auto;
  height: var(--palette-swatch);
}

/* Canvas frame “contain” behavior:
   - never exceeds available width/height
   - keeps aspect
   - centers inside container
*/
.canvas-container {
  display: grid;
  place-items: center;
}
.canvas-frame {
  width: min(100%, 100cqw - 2 * var(--ui-pad));
  max-width: 1200px;
  max-height: calc(100cqh - 2 * var(--ui-pad));
  overflow: hidden;               /* prevent frame overflow when tiny */
  margin: 0 auto;
}
#paintCanvas {
  width: min(100%, 100cqw);       /* contain by width first */
  height: auto;
  max-height: calc(100cqh - 4rem);/* stop pushing UI offscreen */
}

/* 4) Orientation & aspect-ratio adaptations */

/* A) Ultra-wide (cinematic) – put color box to the right of the canvas */
@media (min-aspect-ratio: 21/9) {
  .workspace {
    grid-template-columns: 1fr minmax(220px, 26cqw);
    grid-template-rows: auto 1fr;
    grid-template-areas:
      "opts opts"
      "canvas colors";
    column-gap: clamp(8px, 2cqw, 24px);
  }
  .color-box {
    align-self: stretch;
    overflow: auto;               /* palette scrolls independently */
  }
}

/* B) Ultra-tall / narrow (phones, chat sidebars, tall iframes)
   - move side toolbar to top as a horizontal strip
   - keep canvas below, colors at bottom
*/
@media (max-aspect-ratio: 9/16) {
  .toolbars {
    grid-template-columns: 1fr;
    grid-template-rows: auto 1fr;
    grid-template-areas:
      "side"
      "workspace";
  }
  .side-toolbar {
    grid-template-columns: repeat(auto-fit, minmax(var(--tool-size), 1fr));
    grid-auto-rows: var(--tool-size);
    width: 100%;
    max-height: clamp(40px, 12cqh, 96px);
    overflow-x: auto;             /* horizontal scroll if needed */
    overflow-y: hidden;
  }
  .workspace {
    grid-template-rows: auto 1fr auto;
  }
  .canvas-frame {
    max-width: 100%;
    max-height: calc(100cqh - 14rem); /* leave space for toolbars/colors */
  }
}

/* C) Very low heights (e.g., letterbox iframes)
   - compress paddings, shrink icons, make palette scrollable
*/
@media (max-height: 520px) {
  :root {
    --ui-pad: 6px;
    --tool-size: 20px;
  }
  .option-bars { padding: 4px 8px; }
  .color-box   { padding: 6px 8px; }
  .color-palette { max-height: 120px; overflow: auto; }
  .status-bar { display: none; } /* reclaim a bit of height */
}

/* D) Very small widths
   - let palette wrap to fewer columns
   - keep controls tappable
*/
@media (max-width: 360px) {
  .menu-item { padding: 2px 6px; font-size: 11px; }
  .option-bars .tool-options { gap: 8px; }
  .color-palette {
    grid-template-columns: repeat(8, minmax(var(--palette-swatch), 1fr));
  }
}

/* 5) Container-based refinements (works even when iframes don’t report viewport nicely) */
@container app (max-width: 700px) {
  .option-bars .tool-options { flex-wrap: wrap; gap: 8px; }
  .size-button, .shape-button { width: clamp(22px, 6cqw, 28px); height: clamp(18px, 5cqw, 24px); }
}
@container app (max-height: 480px) {
  .canvas-container { padding: 6px; }
  .canvas-frame { padding: 6px; }
}

/* 6) Prevent zoom pushing UI: the canvas scrolls instead */
#paintCanvas.zoomed {
  max-width: none;           /* allow transform scale without shrinking */
  max-height: none;
}
.canvas-frame:has(#paintCanvas.zoomed) {
  overflow: auto;            /* scrollbars live inside the frame */
}

/* 7) Nice-to-haves for tiny spaces */
.tool-options { row-gap: 6px; }
.option-group { padding: 3px; }
.menu-bar     { flex-wrap: wrap; row-gap: 2px; }

/* === Toolbar overflow (+) styles === */
.tool-button.more-button::before{
  content:""; position:absolute; inset:6px;
  background-image:url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="16" height="16"%3E%3Crect x="2" y="2" width="12" height="12" fill="none" stroke="%23000" stroke-width="2"/%3E%3Cpath d="M8 4v8M4 8h8" stroke="%23000" stroke-width="2" /%3E%3C/svg%3E');
  background-repeat:no-repeat; background-position:center; background-size:contain; image-rendering:pixelated;
}

/* Always keep tools comfortably clickable */
:root {
  /* raise the minimum touch target without breaking retro look */
  --tool-size: clamp(28px, 3.2cqw, 34px);
  --ui-pad: clamp(4px, 1.5cqw, 12px);
}

/* The toolbar is already a grid; ensure scrolling is hidden by default so we can detect overflow cleanly in JS */
.side-toolbar {
  overflow: hidden;   /* JS will toggle auto when zoomed canvas is active */
}

/* Retro popup menu (for + overflow) */
.tools-overflow-menu{
  position: absolute;
  z-index: 9999;
  min-width: 156px;
  max-width: 220px;
  max-height: 60cqh;
  overflow: auto;
  background:#c0c0c0;
  border:1px solid #808080;
  box-shadow: inset -1px -1px #404040, inset 1px 1px #fff;
  padding: 3px;
  display: none;
}
.tools-overflow-menu.open{ display:block; }

.tools-overflow-item{
  display:flex; align-items:center; gap:8px;
  padding:3px 6px; font-size:12px; cursor:default;
  border:1px solid transparent; background:#c0c0c0;
}
.tools-overflow-item:hover{
  border:1px solid #000080; background:#000080; color:#fff;
}
.tools-overflow-swatch{
  width: var(--tool-size); height: var(--tool-size);
  border:1px solid #808080;
  box-shadow: inset -1px -1px #404040, inset 1px 1px #fff;
  position:relative;
}
.tools-overflow-swatch::before{
  content:""; position:absolute; inset:6px; background-repeat:no-repeat; background-position:center; background-size:contain; image-rendering:pixelated;
}

/* Keep the + button visually last and stable */
.more-button { order: 9999; }

/* When the toolbar switches to horizontal mode (your @media max-aspect-ratio: 9/16), make sure overflow opens below */
@media (max-aspect-ratio: 9/16){
  .tools-overflow-menu { max-height: 40cqh; }
}

/* Slightly bump contrast for better visibility on tiny screens */
@media (max-width: 360px){
  .tool-button { box-shadow: inset -1px -1px #404040, inset 1px 1px #fff, 0 0 0 1px #0001; }
}
