<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>XP Explorer</title>
<link rel="icon" href="data:," />
<style>
  /* ===== Windows XP core look ===== */
  :root{
    --xp-blue:#245edb;
    --xp-blue-light:#e9f0ff;
    --xp-gray:#c0c0c0;
    --xp-border:#808080;
    --pane-width: 230px;
  }
  html,body{height:100%;margin:0}
  body{font:12px Tahoma,Verdana,Arial,sans-serif;background:#dcdcdc;color:#000}

  /* Fill 100% window (no title bar) */
  .window{
    position:fixed; inset:0;          /* full bleed */
    border:1px solid var(--xp-border);
    background:#fff; display:flex; flex-direction:column;
  }

  /* Toolbar + address (XP vibe) */
  .toolbar{
    background:var(--xp-gray);
    border-top:1px solid #fff; border-bottom:1px solid var(--xp-border);
    padding:4px; display:flex; align-items:center; gap:6px;
  }

  /* XP-style nav buttons */
  .navgroup{display:flex; gap:4px; align-items:center}
  .xpbtn{
    display:inline-flex; align-items:center; gap:6px;
    border:1px solid #6b6b6b; border-right-color:#3d3d3d; border-bottom-color:#3d3d3d;
    background:linear-gradient(#fdfdfd,#dcdcdc);
    padding:2px 8px 3px; border-radius:3px; cursor:pointer; user-select:none;
    box-shadow: inset 0 0 0 1px #fff, inset 0 0 0 2px #f4f4f4;
    font-weight:bold; color:#003; min-height:24px;
  }
  .xpbtn:active{background:linear-gradient(#dcdcdc,#fdfdfd)}
  .xpbtn[disabled]{
    opacity:.45; filter:grayscale(100%); cursor:not-allowed;
  }
  .xpico{width:18px;height:18px;display:inline-block}

  .address{display:flex; align-items:center; gap:6px; margin-left:auto; width:55%}
  .addrlabel{white-space:nowrap}
  .addrbox{flex:1;background:#fff;border:1px solid var(--xp-border);padding:2px 6px;overflow:hidden;text-overflow:ellipsis}

  /* Layout */
  .content{flex:1; display:flex; min-height:0}
  .leftpane{
    width:var(--pane-width);
    background: linear-gradient(#e3efff,#cfe1ff,#bcd3ff);
    border-right:1px solid var(--xp-border);
    padding:8px; overflow:auto;
  }
  .modal .close{
    position:absolute; top:10px; right:16px;
    padding:4px 10px; cursor:pointer; user-select:none;
    background:linear-gradient(#fefefe,#e8e8e8);
    border:1px solid #555; border-right-color:#333; border-bottom-color:#333;
    border-radius:14px; font-weight:bold; color:#111;
    box-shadow: inset 0 0 0 1px #fff, 0 1px 0 rgba(0,0,0,.25);
  }
  .modal .close:hover{ background:linear-gradient(#ffffff,#f3f3f3); }
  .modal .close:active{ background:linear-gradient(#e8e8e8,#fefefe); transform: translateY(1px); }
    
  .leftpane h4{margin:8px 0 6px 4px; color:#102a5c}
  .quicklink{display:block;padding:6px 8px;margin:2px 0;border-radius:3px;color:#102a5c;text-decoration:none}
  .quicklink:hover{background:rgba(255,255,255,.7);cursor:pointer;}
  .qs{font-size:11px;color:#123}
  .rightpane{flex:1;display:flex;flex-direction:column;min-width:0}
  .breadcrumbs{
    padding:6px 8px;background:var(--xp-blue-light);border-bottom:1px solid #b6c9ff;font-size:11px;
    overflow:auto; white-space:nowrap;
  }
  .breadcrumbs a{color:#114fae;text-decoration:none}
  .breadcrumbs a:hover{text-decoration:underline}

  /* Grid */
  .grid{
    padding:10px; gap:12px; align-content:flex-start;
    display:grid; grid-template-columns:repeat(auto-fill,minmax(130px,1fr)); overflow:auto;
  }
  .tile{
    list-style:none; border:1px solid transparent; padding:8px; border-radius:6px; cursor:pointer;
    display:flex; flex-direction:column; align-items:center; gap:8px; user-select:none; background:#fff;
  }
  .tile:hover{border-color:#9db3f9;background:#f7faff}
  .thumb{
    width:100%; max-width:110px; height:78px; background:#f0f0f0; border:1px solid #bbb;
    display:flex; align-items:center; justify-content:center; overflow:hidden; border-radius:4px;
  }
  .thumb img{width:100%; height:100%; object-fit:cover; display:block}
  .label{font-size:11px; text-align:center; word-break:break-word}
  .tile .details{font-size:10px; color:#333; text-align:center;}
  .badge{position:absolute; top:6px; right:8px; font-size:10px; background:#fff;border:1px solid #aaa;border-radius:10px;padding:1px 6px;display:none;}
  .tile .meta{position:relative;width:100%}

  /* Modal (lightbox/video) */
  .modal{position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; align-items:center; justify-content:center; padding:20px}
  .modal.open{display:flex}
  .modal-box{background:#000; max-width:90vw; max-height:90vh; border:2px solid #fff; box-shadow:0 0 0 1px #000}
  .modal img{display:block; max-width:90vw; max-height:90vh}
  .modal iframe{display:block; width:min(90vw,960px); height:min(80vh,540px); border:0}


  /* Tiny icons */
  .icon-folder,.icon-video,.icon-drive,.icon-disc{width:20px;height:16px}
  @media (max-width: 768px){
    .address{width:48%}
    :root{ --pane-width: 200px; }
  }
  .thumb .icon-folder{
    width:100%;
    height:100%;
    display:block;    
  }  
  .thumb .icon-drive {
    width:100%;
    height:100%;
    display:block;     
  }    
  .thumb .icon-disc {
    width:100%;
    height:100%;
    display:block;     
  }    

  .tile:has(.icon-folder) .thumb{
    background:transparent;
    border:0;
  }  
  .tile:has(.icon-drive) .thumb{
    background:transparent;
    border:0;
  }    
  .tile:has(.icon-disc) .thumb{
    background:transparent;
    border:0;
  }      
</style>
</head>
<body>
  <div class="window" role="application" aria-label="Windows XP Explorer">

    <div class="toolbar">
      <div class="navgroup">
        <!-- Back -->
        <button class="xpbtn" id="backBtn" title="Back">
          <span class="xpico" aria-hidden="true">
            <!-- XP green left arrow -->
            <svg viewBox="0 0 24 24"><defs><linearGradient id="g" x1="0" y1="0" x2="0" y2="1"><stop offset="0" stop-color="#7ce07a"/><stop offset="1" stop-color="#26a326"/></linearGradient></defs>
              <circle cx="12" cy="12" r="11" fill="url(#g)" stroke="#0c6e0c"/>
              <path d="M13 7l-5 5 5 5" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          Back
        </button>
        <!-- Forward -->
        <button class="xpbtn" id="fwdBtn" title="Forward">
          <span class="xpico" aria-hidden="true">
            <svg viewBox="0 0 24 24"><defs><linearGradient id="g2" x1="0" y1="0" x2="0" y2="1"><stop offset="0" stop-color="#7ce07a"/><stop offset="1" stop-color="#26a326"/></linearGradient></defs>
              <circle cx="12" cy="12" r="11" fill="url(#g2)" stroke="#0c6e0c"/>
              <path d="M11 7l5 5-5 5" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          Forward
        </button>
        <!-- Up -->
        <button class="xpbtn" id="upBtn" title="Up One Level">
          <span class="xpico" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <rect x="3" y="9" width="18" height="10" rx="2" fill="#ffd168" stroke="#cc9b20"/>
              <path d="M12 5l-4 4h8z" fill="#2a62d6" stroke="#153b8c"/>
            </svg>
          </span>
          Up
        </button>
      </div>

      <div class="address">
        <span class="addrlabel">Address:</span>
        <div class="addrbox" id="addressBox">My Documents\Pictures</div>
      </div>
    </div>

    <div class="content">
      <aside class="leftpane">
        <h4>File and Folder Tasks</h4>
        <div class="qs">Quick Links</div>
        <nav id="quicklinks"></nav>

        <h4>Other Places</h4>
        <a class="quicklink" data-path="/">üóÇÔ∏è Documents</a>
        <a class="quicklink" data-path="/Pictures">üñºÔ∏è Pictures</a>
        <a class="quicklink" data-path="/Videos">üé¨ Videos</a>
        <a class="quicklink" data-path="/My PC">üíª My PC</a>
      </aside>

      <main class="rightpane">
        <div class="breadcrumbs" id="breadcrumbs"></div>
        <ul class="grid" id="grid" aria-label="Folder content"></ul>
      </main>
    </div>
  </div>

  <!-- Lightbox -->
  <div class="modal" id="modal">
    <button class="close" id="modalClose">Close ‚úï</button>
    <div class="modal-box" id="modalBox"></div>
  </div>

<script>
/* ========= Where your pictures live + defaults ========= */
const PICTURES_BASE = "pictures/"; // adjust to "../pictures/" if needed
const DEFAULT_PICTURES = [
  "myrtle.png",
  "boner.png",
  "bigboner.png",
  "entrado.png",
  "53945hg.png"
];

/* ========= Build a folder object from a filename list ========= */
function pictureFolder(files, base = PICTURES_BASE) {
  const children = {};
  files.forEach(name => {
    if (!name || typeof name !== "string") return;
    children[name] = { type: "image", src: base + name, title: name.replace(/\.\w+$/, "") };
  });
  return { type: "folder", children };
}

/* ========= Try to load pictures/index.json (array of filenames) =========
Example /pictures/index.json:
["myrtle.png","boner.png","bigboner.png","entrado.png","53945hg.png","new1.jpg"]
*/
async function loadPictureList() {
  const url = PICTURES_BASE + "index.json";
  const res = await fetch(url, { cache: "no-store" });
  if (!res.ok) throw new Error("index.json not found");
  const data = await res.json();
  if (!Array.isArray(data)) throw new Error("index.json must be an array");
  return data;
}

/* ================= In-memory filesystem (Pictures injected at boot) ================= */
let FS = null;

/* ===== Quick Links (left pane) ===== */
const QUICKLINKS = [
  { label:"üìÅ Pictures", path:"/Pictures" },
  { label:"üé¨ Videos", path:"/Videos" },
  { label:"üíª My PC", path:"/My PC" },
];

/* ===== Router / Navigation ===== */
const gridEl = document.getElementById('grid');
const addrBox = document.getElementById('addressBox');
const crumbsEl = document.getElementById('breadcrumbs');
const modal = document.getElementById('modal');
const modalBox = document.getElementById('modalBox');



const backBtn = document.getElementById('backBtn');
const fwdBtn  = document.getElementById('fwdBtn');
const upBtn   = document.getElementById('upBtn');

const historyStack = []; let forwardStack = [];


/* ===== Modal ===== */
const modalClose = document.getElementById('modalClose');

function closeModal(){
  // If an <iframe> video is playing, blank it to stop playback, then clear the box
  const ifr = modalBox.querySelector('iframe');
  if (ifr) {
    try { ifr.src = 'about:blank'; } catch(e){}
  }
  // If you later use <video>, pause it too
  modalBox.querySelectorAll('video').forEach(v => { try { v.pause(); v.currentTime = 0; } catch(e){} });

  modalBox.innerHTML = '';
  modal.classList.remove('open');
}

modalClose.onclick = closeModal;
modal.addEventListener('click', (e)=>{ if(e.target===modal) closeModal(); });
window.addEventListener('keydown', (e)=>{ if(e.key === 'Escape' && modal.classList.contains('open')) closeModal(); });


function setHash(path){ location.hash = encodeURIComponent(path); }
function getHash(){ return decodeURIComponent(location.hash.replace(/^#/, '') || "/Pictures"); }

function getNode(path){
  if (!FS) return null;
  const parts = path.split('/').filter(Boolean);
  let node = FS;
  for(const p of parts){
    if(!node.children || !node.children[p]) return null;
    node = node.children[p];
  }
  return node;
}

function parentPath(path){
  const parts = path.split('/').filter(Boolean);
  parts.pop();
  return "/" + parts.join('/');
}

function updateNavStates(path){
  backBtn.disabled = historyStack.length === 0;
  fwdBtn.disabled  = forwardStack.length === 0;
  upBtn.disabled   = (path === "/");
}

function render(path){
  const node = getNode(path) || FS;
  if (!node) return;

  // Address bar (XP-style backslashes)
  addrBox.textContent = "My Documents" + (path==="/" ? "" : ("\\" + path.split('/').filter(Boolean).join('\\')));

  // Breadcrumbs
  const parts = path.split('/').filter(Boolean);
  let acc = "";
  crumbsEl.innerHTML = '<a href="#" data-path="/">My Documents</a>' +
    parts.map(p => { acc += "/" + p; return ' \\ <a href="#" data-path="'+acc+'">'+p+'</a>'; }).join('');

  // Grid
  gridEl.innerHTML = "";
  const items = node.children || {};
  Object.entries(items).forEach(([name, item]) => {
    const li = document.createElement('li'); li.className="tile"; li.tabIndex=0;
    const meta = document.createElement('div'); meta.className="meta";
    const thumb = document.createElement('div'); thumb.className="thumb";

    if(item.icon === "drive"){
      thumb.innerHTML = driveSVG();
    }else if(item.icon === "disc"){
      thumb.innerHTML = discSVG();
    }else if(item.type==="folder" || item.type==="shortcut"){
      thumb.innerHTML = folderSVG();
    }else if(item.type==="youtube"){
      const id = youtubeId(item.url);
      const t = item.thumb || (id ? `https://img.youtube.com/vi/${id}/hqdefault.jpg` : "");
      if(t){ const img = new Image(); img.src=t; thumb.appendChild(img); } else { thumb.innerHTML = videoSVG(); }
      const b = document.createElement('div'); b.className='badge'; b.textContent='YouTube'; meta.appendChild(b);
    }else if(item.type==="weblink"){
      thumb.innerHTML = linkSVG();
      const b = document.createElement('div'); b.className='badge'; b.textContent='Link'; meta.appendChild(b);
    }else if(item.type==="image"){
      const img = new Image(); img.loading = "lazy"; img.decoding = "async";
      img.src=item.thumb || item.src; thumb.appendChild(img);
    }else{
      thumb.textContent = "-";
    }

    const label = document.createElement('div'); label.className="label"; label.textContent = (item.title || name).replace(/\.yt$/,'');

    li.appendChild(thumb);
    li.appendChild(label);
    if(item.details){
      const detail = document.createElement('div'); detail.className = 'details'; detail.textContent = item.details;
      li.appendChild(detail);
    }
    li.appendChild(meta);
    li.addEventListener('dblclick', () => openItem(path, name, item));
    li.addEventListener('keydown', e => { if(e.key==="Enter"){ openItem(path,name,item);} });

    gridEl.appendChild(li);
  });

  // crumb clicks
  crumbsEl.querySelectorAll('a[data-path]').forEach(a=>{
    a.addEventListener('click', (e)=>{ e.preventDefault(); navigateTo(a.dataset.path); });
  });

  updateNavStates(path);
}

function openItem(currentPath, name, item){
  if(item.type==="folder"){
    navigateTo(currentPath.replace(/\/$/,'') + "/" + name);
  }else if(item.type==="shortcut"){
    navigateTo(item.to);
  }else if(item.type==="weblink"){
    window.open(item.href, "_blank", "noopener");
  }else if(item.type==="image"){
    openImage(item.src);
  }else if(item.type==="youtube"){
    openYouTube(item.url);
  }
}

function navigateTo(path){
  const cur = getHash();
  if(cur!==path){
    historyStack.push(cur);
    forwardStack = [];
    setHash(path);
  }else{
    render(path);
  }
}

function back(){ if(historyStack.length){ const prev = historyStack.pop(); forwardStack.push(getHash()); setHash(prev); } }
function forward(){ if(forwardStack.length){ const next = forwardStack.pop(); historyStack.push(getHash()); setHash(next); } }
function up(){ const p = parentPath(getHash()); navigateTo(p || "/"); }

backBtn.onclick = back; fwdBtn.onclick = forward; upBtn.onclick = up;

/* ===== Modal ===== */

modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.classList.remove('open'); });

function openImage(src){
  closeModal();
  modalBox.innerHTML = `<img src="${src}" alt="Image" />`;
  modal.classList.add('open');
}

function openYouTube(url){
  closeModal();
  const id = youtubeId(url);
  const origin = (window.location.origin && window.location.origin !== 'null' && window.location.origin !== 'file://') ? encodeURIComponent(window.location.origin) : encodeURIComponent('https://www.youtube.com');
  const safe = id ? `https://www.youtube-nocookie.com/embed/${id}?autoplay=1&rel=0&modestbranding=1&playsinline=1&enablejsapi=1&origin=${origin}` : url;
  modalBox.innerHTML = `<iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen src="${safe}"></iframe>`;
  modal.classList.add('open');
}

window.addEventListener('hashchange', () => { 
  closeModal();
  render(getHash());
});
/* ===== Helpers ===== */
function youtubeId(url){ const m = url.match(/(?:youtu\.be\/|v=|embed\/)([A-Za-z0-9_-]{6,})/); return m ? m[1] : null; }
function folderSVG(){
  return `<svg class="icon-folder" viewBox="0 0 64 48" aria-hidden="true">
    <path fill="#f0c419" d="M3 10h20l5 6h33v26a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4z"/>
    <path fill="#f9d365" d="M3 10h20l5 6H3z"/>
    <rect x="3" y="16" width="58" height="26" fill="#ffe08a"/>
  </svg>`;
}
function videoSVG(){
  return `<svg class="icon-video" viewBox="0 0 64 48" aria-hidden="true">
    <rect x="2" y="6" width="60" height="36" fill="#111"/><polygon points="26,16 46,24 26,32" fill="#fff"/>
  </svg>`;
}
function linkSVG(){
  return `<svg class="icon-video" viewBox="0 0 64 48" aria-hidden="true">
    <rect x="4" y="10" width="56" height="28" fill="#e9f0ff" stroke="#8aa2ff"/>
    <path d="M22 24h20" stroke="#245edb" stroke-width="4" stroke-linecap="round"/>
  </svg>`;
}
function driveSVG(){
  return `<svg class="icon-drive" viewBox="0 0 64 48" aria-hidden="true">
    <rect x="6" y="12" width="52" height="26" fill="#d0d6e4" stroke="#7a838f"/>
    <rect x="14" y="18" width="36" height="12" fill="#f8fbff" stroke="#b0b8c4"/>
    <circle cx="24" cy="34" r="2" fill="#6c7785"/>
    <circle cx="32" cy="34" r="2" fill="#6c7785"/>
    <circle cx="40" cy="34" r="2" fill="#6c7785"/>
  </svg>`;
}
function discSVG(){
  return `<svg class="icon-disc" viewBox="0 0 64 48" aria-hidden="true">
    <circle cx="32" cy="24" r="18" fill="#f0f3ff" stroke="#7a83d6"/>
    <circle cx="32" cy="24" r="6" fill="#c7ccf4" stroke="#5a64b6"/>
    <rect x="20" y="8" width="24" height="6" fill="#d8dcef" stroke="#5a64b6"/>
  </svg>`;
}

/* ===== Quick Links render ===== */
(function renderQuickLinks(){
  const q = document.getElementById('quicklinks');
  QUICKLINKS.forEach(({label,path})=>{
    const a = document.createElement('a');
    a.href="#"; a.className="quicklink"; a.textContent=label; a.dataset.path=path;
    a.addEventListener('click', e=>{ e.preventDefault(); navigateTo(path); });
    q.appendChild(a);
  });
})();

document.querySelectorAll('.leftpane .quicklink[data-path]').forEach(a=>{
  a.addEventListener('click', (e)=>{
    e.preventDefault();
    const p = a.getAttribute('data-path');
    if (p) navigateTo(p);
  });
});

/* ===== Boot: build FS (with index.json fallback), then render ===== */
(async function boot(){
  let pictureNames = DEFAULT_PICTURES;
  try {
    const list = await loadPictureList();
    if (Array.isArray(list) && list.length) pictureNames = list;
  } catch (e) {
    // No index.json or invalid ‚Äî use defaults
  }

  const picturesFolder = pictureFolder(pictureNames, PICTURES_BASE);

  picturesFolder.children["Cards"] = {
    type: "folder",
    children: {}
  };

  FS = {
    type: "folder",
    title: "My Documents",
    children: {
      "Pictures": picturesFolder,
      "Videos": {
        type:"folder",
        children: {
          "Surprise.yt": {type:"youtube", url:"https://www.youtube.com/watch?v=dQw4w9WgXcQ", title:"Surprise Video"},
          "YouCanRun.yt": {type:"youtube", url:"https://youtu.be/8jF94CmIYe0?si=2xDiKmDITrEJTRP9", title:"You can run, but..."},
          "Big Buck Bunny.yt": {type:"youtube", url:"https://youtu.be/aqz-KE-bpKQ", title:"Demo"}
        }
      },
      "My PC": {
        type:"folder",
        children: {
          "Pictures": {type:"shortcut", to:"/Pictures"},
          "Videos":   {type:"shortcut", to:"/Videos"},
          "Cards":    {type:"shortcut", to:"/Pictures/Cards"},
          "Local Disk (C:)": {
            type:"folder",
            icon:"drive",
            details:"120 GB free of 256 GB",
            children: {
              "Program Files": {type:"folder", children:{}},
              "Users": {type:"folder", children:{}},
              "Windows": {type:"folder", children:{}}
            }
          },
          "CD Drive (D:)": {
            type:"folder",
            icon:"disc",
            details:"No disc inserted",
            children: {}
          }
        }
      }
    }
  };

  // Start / hash routing only after FS is ready
  window.addEventListener('hashchange', ()=> render(getHash()));
  render(getHash());
})();
</script>
</body>
</html>
